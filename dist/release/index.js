console.log("### App Framework ### Start: 0.1.1 Build 20190417"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.DanMa=e()}(this,function(){"use strict";var e={canvas:null},t="undefined"!=typeof window;function i(t){return Number(t.replace(/[^\d]/g,""))}var n,o={document:{}};o.document.createElement=t?window.document.createElement.bind(window.document):function(){return e.canvas},o.document.getElementById=t?window.document.getElementById.bind(window.document):function(){return{offsetHeight:i(e.canvas._finalStyleCache.height),offsetWidth:i(e.canvas._finalStyleCache.width),style:{},appendChild:function(){}}},o.devicePixelRatio=t?window.devicePixelRatio:1,"undefined"!=typeof window?n=window:"undefined"!=typeof global&&(n=global);var s=n.requestAnimationFrame||function(t){return setTimeout(t,16)},h=n.cancelAnimationFrame||function(t){return clearTimeout(t)};var a=function(t,e){void 0===e&&(e=10),this.parent=t&&1===t.nodeType?t:o.document.getElementById(t),this.parent.style.position=this.parent.style.position||"relative",this.layer=o.document.createElement("canvas"),this.context=this.layer.getContext("2d"),this.dpr=o.devicePixelRatio||1,this.stageHeight=this.parent.offsetHeight*this.dpr,this.stageWidth=this.parent.offsetWidth*this.dpr,this.lines=e,this.lineHeight=Math.max(this.stageHeight/e,12),this.layer.width=this.parent.offsetWidth*this.dpr,this.layer.height=this.parent.offsetHeight*this.dpr,this.layer.style.width=this.parent.offsetWidth+"px",this.layer.style.height=this.parent.offsetHeight+"px",this.layer.style.display="block",this.layer.style.position="absolute",this.layer.style.left=0,this.layer.style.top=0,this.layer.style.zIndex=1e4,this.pool=null,this.paintTimer=null,this._isRunning=!1};a.prototype.$mount=function(){return this.parent.appendChild(this.layer),this},a.prototype.$connect=function(t){return this.pool=t,this},a.prototype.clear=function(){this.context.clearRect(0,0,this.stageWidth,this.stageHeight)},a.prototype.paint=function(){if(this.clear(),this._isRunning=!1,!this.pool.isEmpty()){this._isRunning=!0;for(var t=this.pool.getDms(),e=t.length-1;0<=e;e--)t[e].move(),this.context.font=t[e].font,this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle=t[e].color,this.context.fillText(t[e].text,t[e].x,t[e].y),t[e].x+t[e].textWidth<-this.stageWidth&&this.pool.removeDm(e);this.paintTimer=s(this.paint.bind(this))}},a.prototype.pause=function(){this.paintTimer&&h(this.paintTimer),this.paintTimer=null},a.prototype.hasStoped=function(){return!this._isRunning&&!this.paintTimer};function r(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=this;if(i.instancePool.length){var n=i.instancePool.pop();return i.apply(n,t),n}return new(Function.prototype.bind.apply(i,[null].concat(t)))}function p(t){var e=this;t instanceof e?(t.dispose&&t.dispose(),e.instancePool.length<e.poolSize&&e.instancePool.push(t)):console.warn(t+" 不是 "+e+"的实例")}var l=function(t,e,i,n,o){this.x=t,this.y=e,this.text=i||"测试",this.font=n+"px sans-serif",this.color=o,this.textWidth=0,this.speed=0};l.prototype.setV=function(t){this.textWidth=t.measureText(this.text).width,this.speed=Math.pow(this.textWidth,1/3)},l.prototype.move=function(){this.x=this.x-this.speed},l.prototype.dispose=function(){this.textWidth=0,this.speed=0};var c,d=((c=l).instancePool=[],c.poolSize=10,c.getPooler=r,c.release=p,c),u=function(){this._data=[],this._index=0};u.prototype.pushDm=function(t,e){this._index++,this._index>=e.lines&&(this._index=0);var i=d.getPooler(e.stageWidth,e.lineHeight*this._index,t.text,e.lineHeight,t.color);i.setV(e.context),this._data.push(i)},u.prototype.removeDm=function(t){d.release(this._data[t]),this._data.splice(t,1)},u.prototype.clearDms=function(){this._data=[]},u.prototype.getDms=function(){return this._data},u.prototype.isEmpty=function(){return 0===this._data.length};var f=function(t,e){this.stage=new a(t,e),this.pool=new u,this._init()};return f.prototype.$pause=function(){this.stage.pause()},f.prototype.$start=function(){this.stage.paint()},f.prototype._init=function(){this.stage.$mount().$connect(this.pool)},f.prototype.$receive=function(t){this.pool.pushDm(t,this.stage),this.stage.hasStoped()&&this.stage.paint()},f.setOptions=function(t){e=t},f});
//# sourceMappingURL=index.js.map
